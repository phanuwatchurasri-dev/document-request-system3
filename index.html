<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏î‡∏¥‡∏©‡∏ê‡πå</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #FC8EAC 0%, #e91e63 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg text-white py-6 shadow-lg">
        <div class="container mx-auto px-4">
            <div class="text-center">
                <h1 class="text-4xl font-bold mb-2">üè´ ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</h1>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£ üè´ ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏î‡∏¥‡∏©‡∏ê‡πå</h2>
                <p class="text-lg opacity-90">‡∏¢‡∏∑‡πà‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏î‡πâ‡∏ï‡∏•‡∏≠‡∏î 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</p>
                <div class="mt-4 flex justify-center items-center space-x-4">
                    <div id="saveStatus" class="text-yellow-300 text-xs opacity-75">üíæ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>
                    <div id="syncStatus" class="text-green-300 text-xs opacity-75">üîÑ ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</div>
                    <div id="pendingCount" class="text-orange-300 text-xs opacity-75 hidden">‚è≥ ‡∏£‡∏≠‡∏ã‡∏¥‡∏á‡∏Ñ‡πå: 0</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Action Cards -->
        <div class="grid md:grid-cols-3 gap-6 mb-8">
            <!-- Submit Request Card -->
            <div class="card-hover bg-white rounded-xl shadow-lg p-6 text-center border-t-4 border-blue-500">
                <div class="text-5xl mb-4">üìù</div>
                <h3 class="text-xl font-bold text-gray-800 mb-3">‡∏¢‡∏∑‡πà‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</h3>
                <p class="text-gray-600 mb-4">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡πà‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</p>
                <button onclick="showSubmitForm()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-300">
                    ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏¢‡∏∑‡πà‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠
                </button>
            </div>

            <!-- Track Status Card -->
            <div class="card-hover bg-white rounded-xl shadow-lg p-6 text-center border-t-4 border-green-500">
                <div class="text-5xl mb-4">üîç</div>
                <h3 class="text-xl font-bold text-gray-800 mb-3">‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏Ç‡∏≠</h3>
                <p class="text-gray-600 mb-4">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</p>
                <button onclick="showTrackForm()" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-300">
                    ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                </button>
            </div>

            <!-- Admin Login Card -->
            <div class="card-hover bg-white rounded-xl shadow-lg p-6 text-center border-t-4 border-purple-500">
                <div class="text-5xl mb-4">üë®‚Äçüíº</div>
                <h3 class="text-xl font-bold text-gray-800 mb-3">‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</h3>
                <p class="text-gray-600 mb-4">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</p>
                <button onclick="showAdminLogin()" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-300">
                    Admin Login
                </button>
            </div>
        </div>

        <!-- Statistics Section -->
        <div id="statsSection" class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h3 class="text-2xl font-bold text-gray-800 mb-4 text-center">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</h3>
            <div class="grid md:grid-cols-4 gap-4">
                <div class="text-center p-4 bg-blue-50 rounded-lg">
                    <div class="text-3xl font-bold text-blue-600" id="totalRequestsCount">0</div>
                    <div class="text-sm text-gray-600">‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                </div>
                <div class="text-center p-4 bg-yellow-50 rounded-lg">
                    <div class="text-3xl font-bold text-yellow-600" id="pendingRequestsCount">0</div>
                    <div class="text-sm text-gray-600">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</div>
                </div>
                <div class="text-center p-4 bg-green-50 rounded-lg">
                    <div class="text-3xl font-bold text-green-600" id="completedRequestsCount">0</div>
                    <div class="text-sm text-gray-600">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</div>
                </div>
                <div class="text-center p-4 bg-purple-50 rounded-lg">
                    <div class="text-3xl font-bold text-purple-600" id="todayRequestsCount">0</div>
                    <div class="text-sm text-gray-600">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
                </div>
            </div>
        </div>

        <!-- Information Section -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h3 class="text-2xl font-bold text-gray-800 mb-4 text-center">üìã ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ç‡∏≠‡πÑ‡∏î‡πâ</h3>
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-3">
                <div class="flex items-center p-2 bg-blue-50 rounded-lg">
                    <span class="text-lg mr-2">üìú</span>
                    <span class="text-sm font-medium">‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏õ‡∏û.7 (‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ)</span>
                </div>
                <div class="flex items-center p-2 bg-green-50 rounded-lg">
                    <span class="text-lg mr-2">üìã</span>
                    <span class="text-sm font-medium">‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô(‡∏õ‡∏û.7)</span>
                </div>
                <div class="flex items-center p-2 bg-yellow-50 rounded-lg">
                    <span class="text-lg mr-2">üéì</span>
                    <span class="text-sm font-medium">‡πÉ‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏õ‡∏û.1 (‡∏Å‡∏£‡∏ì‡∏µ‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤)</span>
                </div>
                <div class="flex items-center p-2 bg-pink-50 rounded-lg">
                    <span class="text-lg mr-2">üìä</span>
                    <span class="text-sm font-medium">‡πÉ‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏õ‡∏û.1 (4 ‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô)</span>
                </div>
                <div class="flex items-center p-2 bg-purple-50 rounded-lg">
                    <span class="text-lg mr-2">üìà</span>
                    <span class="text-sm font-medium">‡πÉ‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏õ‡∏û.1 (5 ‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô)</span>
                </div>
                <div class="flex items-center p-2 bg-indigo-50 rounded-lg">
                    <span class="text-lg mr-2">üìÑ</span>
                    <span class="text-sm font-medium">‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï</span>
                </div>
                <div class="flex items-center p-2 bg-gray-50 rounded-lg">
                    <span class="text-lg mr-2">üìù</span>
                    <span class="text-sm font-medium">‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)</span>
                </div>
            </div>
        </div>

        <!-- Contact Information Section -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h3 class="text-2xl font-bold text-gray-800 mb-4 text-center">üìû ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</h3>
            <div class="grid md:grid-cols-3 gap-4 text-center">
                <div class="flex items-center justify-center p-3 bg-blue-50 rounded-lg">
                    <span class="text-lg mr-2">üìû</span>
                    <div>
                        <div class="text-sm font-medium text-gray-800">‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</div>
                        <div class="text-sm text-blue-600 font-semibold">077-379034</div>
                    </div>
                </div>
                <div class="flex items-center justify-center p-3 bg-green-50 rounded-lg">
                    <span class="text-lg mr-2">üìß</span>
                    <div>
                        <div class="text-sm font-medium text-gray-800">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</div>
                        <div class="text-sm text-green-600 font-semibold">academic@kandit.ac.th</div>
                    </div>
                </div>
                <a href="https://www.facebook.com/‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏î‡∏¥‡∏©‡∏ê‡πå" target="_blank" class="flex items-center justify-center p-3 bg-indigo-50 rounded-lg hover:bg-indigo-100 transition-colors duration-300 cursor-pointer">
                    <svg class="w-6 h-6 mr-2 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                    </svg>
                    <div>
                        <div class="text-sm font-medium text-gray-800">Facebook</div>
                        <div class="text-sm text-indigo-600 font-semibold">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏î‡∏¥‡∏©‡∏ê‡πå</div>
                    </div>
                </a>
            </div>
        </div>
    </main>

    <!-- Submit Form Modal -->
    <div id="submitModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-screen overflow-y-auto">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">üìù ‡∏¢‡∏∑‡πà‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</h2>
                        <button onclick="closeModal('submitModal')" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                    </div>
                    
                    <form id="documentForm" class="space-y-4">
                        <!-- Personal Information -->
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h3 class="font-bold text-blue-800 mb-3">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h3>
                            
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ä‡∏∑‡πà‡∏≠ *</label>
                                    <select name="titlePrefix" required class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</option>
                                        <option value="‡∏ô‡∏≤‡∏¢">‡∏ô‡∏≤‡∏¢</option>
                                        <option value="‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß">‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß</option>
                                        <option value="‡∏ô‡∏≤‡∏á">‡∏ô‡∏≤‡∏á</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *</label>
                                    <input type="text" name="fullName" required class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="‡∏ä‡∏∑‡πà‡∏≠ ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
                                </div>
                            </div>

                            <div class="mt-4">
                                <label class="flex items-center">
                                    <input type="checkbox" id="nameChangeCheck" class="mr-2">
                                    <span class="text-sm">‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</span>
                                </label>
                            </div>

                            <div id="oldNameSection" class="hidden mt-4 grid md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πà‡∏≤</label>
                                    <select name="oldTitlePrefix" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</option>
                                        <option value="‡∏ô‡∏≤‡∏¢">‡∏ô‡∏≤‡∏¢</option>
                                        <option value="‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß">‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß</option>
                                        <option value="‡∏ô‡∏≤‡∏á">‡∏ô‡∏≤‡∏á</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏Å‡πà‡∏≤</label>
                                    <input type="text" name="oldName" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πà‡∏≤ ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏Å‡πà‡∏≤">
                                </div>
                            </div>
                        </div>

                        <!-- Student Information -->
                        <div class="bg-green-50 p-4 rounded-lg">
                            <h3 class="font-bold text-green-800 mb-3">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</h3>
                            
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô *</label>
                                    <input type="text" name="studentId" required class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">‡∏™‡∏ñ‡∏≤‡∏ô‡∏†‡∏≤‡∏û *</label>
                                    <select name="studentStatus" required class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏†‡∏≤‡∏û</option>
                                        <option value="‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</option>
                                        <option value="‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏Å‡πà‡∏≤">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏Å‡πà‡∏≤</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Current Student Fields -->
                            <div id="currentStudentFields" class="grid md:grid-cols-2 gap-4 mt-4 hidden">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô *</label>
                                    <select name="faculty" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</option>
                                        <option value="‡∏°.1">‡∏°.1</option>
                                        <option value="‡∏°.2">‡∏°.2</option>
                                        <option value="‡∏°.3">‡∏°.3</option>
                                        <option value="‡∏°.4">‡∏°.4</option>
                                        <option value="‡∏°.5">‡∏°.5</option>
                                        <option value="‡∏°.6">‡∏°.6</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">‡∏´‡πâ‡∏≠‡∏á *</label>
                                    <input type="text" name="room" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1, 2, 3">
                                </div>
                            </div>

                            <!-- Former Student Fields -->
                            <div id="formerStudentFields" class="grid md:grid-cols-2 gap-4 mt-4 hidden">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏ö *</label>
                                    <select name="graduatedLevel" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏ö</option>
                                        <option value="‡∏°.3">‡∏°.3</option>
                                        <option value="‡∏°.6">‡∏°.6</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏à‡∏ö *</label>
                                    <input type="text" name="graduationYear" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="‡πÄ‡∏ä‡πà‡∏ô 2567">
                                </div>
                            </div>
                        </div>

                        <!-- Document Request -->
                        <div class="bg-yellow-50 p-4 rounded-lg">
                            <h3 class="font-bold text-yellow-800 mb-3">‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ *</h3>
                            
                            <div class="space-y-2 mb-4">
                                <label class="flex items-start p-4 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer">
                                    <input type="checkbox" name="documents" value="‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏õ‡∏û.7 (‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ)" class="mr-3 text-blue-600 mt-1">
                                    <div class="text-sm">
                                        <div class="font-medium">üìú ‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏õ‡∏û.7 (‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ)</div>
                                        <div class="text-gray-500 text-xs mt-1">‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢</div>
                                    </div>
                                </label>
                                
                                <label class="flex items-start p-4 border border-gray-200 rounded-lg hover:bg-green-50 cursor-pointer">
                                    <input type="checkbox" name="documents" value="‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô(‡∏õ‡∏û.7)" class="mr-3 text-green-600 mt-1">
                                    <div class="text-sm">
                                        <div class="font-medium">üìã ‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô(‡∏õ‡∏û.7)</div>
                                        <div class="text-gray-500 text-xs mt-1">‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</div>
                                    </div>
                                </label>
                                
                                <label class="flex items-start p-4 border border-gray-200 rounded-lg hover:bg-yellow-50 cursor-pointer">
                                    <input type="checkbox" name="documents" value="‡πÉ‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏õ‡∏û.1 (‡∏Å‡∏£‡∏ì‡∏µ‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤)" class="mr-3 text-yellow-600 mt-1">
                                    <div class="text-sm">
                                        <div class="font-medium">üéì ‡πÉ‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏õ‡∏û.1 (‡∏Å‡∏£‡∏ì‡∏µ‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤)</div>
                                        <div class="text-gray-500 text-xs mt-1">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏•‡πâ‡∏ß</div>
                                    </div>
                                </label>
                                
                                <label class="flex items-start p-4 border border-gray-200 rounded-lg hover:bg-pink-50 cursor-pointer">
                                    <input type="checkbox" name="documents" value="‡πÉ‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏õ‡∏û.1 (4 ‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô)" class="mr-3 text-pink-600 mt-1">
                                    <div class="text-sm">
                                        <div class="font-medium">üìä ‡πÉ‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏õ‡∏û.1 (4 ‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô)</div>
                                        <div class="text-gray-500 text-xs mt-1">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 4 ‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</div>
                                    </div>
                                </label>
                                
                                <label class="flex items-start p-4 border border-gray-200 rounded-lg hover:bg-purple-50 cursor-pointer">
                                    <input type="checkbox" name="documents" value="‡πÉ‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏õ‡∏û.1 (5 ‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô)" class="mr-3 text-purple-600 mt-1">
                                    <div class="text-sm">
                                        <div class="font-medium">üìà ‡πÉ‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏õ‡∏û.1 (5 ‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô)</div>
                                        <div class="text-gray-500 text-xs mt-1">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 5 ‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</div>
                                    </div>
                                </label>
                                
                                <label class="flex items-start p-4 border border-gray-200 rounded-lg hover:bg-indigo-50 cursor-pointer">
                                    <input type="checkbox" name="documents" value="‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï" class="mr-3 text-indigo-600 mt-1">
                                    <div class="text-sm">
                                        <div class="font-medium">üìÑ ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï</div>
                                        <div class="text-gray-500 text-xs mt-1">‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</div>
                                    </div>
                                </label>
                                
                                <label class="flex items-start p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                                    <input type="checkbox" id="otherDocumentCheck" name="documents" value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ" class="mr-3 text-gray-600 mt-1">
                                    <div class="text-sm flex-1">
                                        <div class="font-medium">üìù ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</div>
                                        <div class="text-gray-500 text-xs mt-1">‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</div>
                                        <div id="otherDocumentInput" class="hidden mt-2">
                                            <input type="text" name="otherDocumentDetail" class="w-full p-2 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-gray-500" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£...">
                                        </div>
                                    </div>
                                </label>
                            </div>

                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (‡∏â‡∏ö‡∏±‡∏ö) *</label>
                                    <input type="number" name="quantity" required min="1" max="10" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå *</label>
                                    <select name="purpose" required class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500">
                                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå</option>
                                        <option value="‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ï‡πà‡∏≠">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ï‡πà‡∏≠</option>
                                        <option value="‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô</option>
                                        <option value="‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤">‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>
                                        <option value="‡πÉ‡∏ä‡πâ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß">‡πÉ‡∏ä‡πâ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</option>
                                        <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                                    </select>
                                    <div id="otherPurposeInput" class="hidden mt-2">
                                        <input type="text" name="otherPurposeDetail" class="w-full p-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-yellow-500" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå...">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Contact Information -->
                        <div class="bg-purple-50 p-4 rounded-lg">
                            <h3 class="font-bold text-purple-800 mb-3">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</h3>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå *</label>
                                <input type="tel" name="phone" required class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" placeholder="‡πÄ‡∏ä‡πà‡∏ô 081-234-5678">
                            </div>
                        </div>

                        <div class="flex gap-4 pt-4">
                            <button type="button" onclick="closeModal('submitModal')" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-semibold py-3 px-6 rounded-lg transition duration-300">
                                ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                            </button>
                            <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-300">
                                ‡∏¢‡∏∑‡πà‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Track Status Modal -->
    <div id="trackModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">üîç ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏Ç‡∏≠</h2>
                        <button onclick="closeModal('trackModal')" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                    </div>
                    
                    <form id="trackForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏Ç‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                            <input type="text" id="searchQuery" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="‡πÄ‡∏ä‡πà‡∏ô REQ0001 ‡∏´‡∏£‡∏∑‡∏≠ ‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ">
                        </div>
                        
                        <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-300">
                            ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                        </button>
                    </form>

                    <div id="trackResult" class="mt-6 hidden">
                        <!-- Results will be displayed here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div id="adminModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-2xl max-w-md w-full">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">üë®‚Äçüíº Admin Login</h2>
                        <button onclick="closeModal('adminModal')" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                    </div>
                    
                    <form id="adminForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                            <input type="text" id="adminUsername" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                            <input type="password" id="adminPassword" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
                        </div>
                        
                        <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-300">
                            ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="hidden">
        <div class="bg-purple-600 text-white py-4 shadow-lg">
            <div class="container mx-auto px-4 flex justify-between items-center">
                <h1 class="text-2xl font-bold">üë®‚Äçüíº Admin Dashboard</h1>
                <div class="flex items-center space-x-4">
                    <span id="adminWelcome" class="text-sm"></span>
                    <button onclick="logout()" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-lg text-sm transition duration-300">
                        ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                    </button>
                </div>
            </div>
        </div>

        <div class="container mx-auto px-4 py-6">
            <!-- Admin Tabs -->
            <div class="bg-white rounded-xl shadow-lg mb-6">
                <div class="border-b border-gray-200">
                    <nav class="flex space-x-8 px-6">
                        <button onclick="showAdminTab('documents')" class="admin-tab-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium text-sm active">
                            üìã ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
                        </button>
                        <button onclick="showAdminTab('users')" class="admin-tab-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium text-sm">
                            üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
                        </button>
                        <button onclick="showAdminTab('stats')" class="admin-tab-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium text-sm">
                            üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
                        </button>
                        <button onclick="showAdminTab('settings')" class="admin-tab-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium text-sm">
                            ‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Sheets
                        </button>
                        <button onclick="showAdminTab('email')" class="admin-tab-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium text-sm">
                            üìß ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                        </button>
                    </nav>
                </div>

                <!-- Documents Management Tab -->
                <div id="documentsTab" class="admin-tab-content p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üìã ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</h3>
                    
                    <div class="mb-4 flex flex-wrap gap-2">
                        <button onclick="filterRequests('all')" class="filter-btn bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm active">
                            ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                        </button>
                        <button onclick="filterRequests('‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏Ç‡∏≠')" class="filter-btn bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm">
                            ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏Ç‡∏≠
                        </button>
                        <button onclick="filterRequests('‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•')" class="filter-btn bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-sm">
                            ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        </button>
                        <button onclick="filterRequests('‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£')" class="filter-btn bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm">
                            ‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
                        </button>
                        <button onclick="filterRequests('‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£')" class="filter-btn bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-sm">
                            ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
                        </button>
                        <button onclick="filterRequests('‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£')" class="filter-btn bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm">
                            ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
                        </button>
                    </div>

                    <div id="requestsList" class="space-y-4">
                        <!-- Requests will be loaded here -->
                    </div>
                </div>

                <!-- Users Management Tab -->
                <div id="usersTab" class="admin-tab-content p-6 hidden">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h3>
                    
                    <div class="mb-4">
                        <button onclick="showAddUserForm()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition duration-300">
                            + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà
                        </button>
                    </div>

                    <div id="usersList" class="space-y-4">
                        <!-- Users will be loaded here -->
                    </div>
                </div>

                <!-- Statistics Tab -->
                <div id="statsTab" class="admin-tab-content p-6 hidden">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</h3>
                    
                    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <div class="bg-blue-50 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-blue-600" id="totalRequests">0</div>
                            <div class="text-sm text-gray-600">‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                        </div>
                        <div class="bg-yellow-50 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-yellow-600" id="pendingRequests">0</div>
                            <div class="text-sm text-gray-600">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</div>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-green-600" id="completedRequests">0</div>
                            <div class="text-sm text-gray-600">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</div>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-purple-600" id="todayRequests">0</div>
                            <div class="text-sm text-gray-600">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
                        </div>
                    </div>

                    <div id="statsCharts" class="space-y-6">
                        <!-- Charts will be rendered here -->
                    </div>
                </div>

                <!-- Settings Tab -->
                <div id="settingsTab" class="admin-tab-content p-6 hidden">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Sheets</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Web App URL *</label>
                            <input type="url" id="webAppUrl" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="https://script.google.com/macros/s/.../exec">
                            <p class="text-xs text-gray-500 mt-1">URL ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å Google Apps Script deployment</p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Spreadsheet ID (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
                            <input type="text" id="spreadsheetId" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms">
                            <p class="text-xs text-gray-500 mt-1">ID ‡∏Ç‡∏≠‡∏á Google Sheets (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö)</p>
                        </div>
                        
                        <div class="flex gap-4">
                            <button onclick="testConnection()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition duration-300">
                                ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                            </button>
                            <button onclick="saveSettings()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition duration-300">
                                ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                            </button>
                        </div>
                        
                        <div id="connectionStatus" class="mt-4"></div>
                    </div>
                </div>

                <!-- Email Settings Tab -->
                <div id="emailTab" class="admin-tab-content p-6 hidden">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üìß ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h3>
                    
                    <div class="space-y-6">
                        <!-- Enable/Disable Notifications -->
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <label class="flex items-center">
                                <input type="checkbox" id="enableNotifications" class="mr-3 text-blue-600">
                                <span class="font-medium text-blue-800">‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•</span>
                            </label>
                            <p class="text-sm text-blue-600 mt-2">‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏ß‡πâ</p>
                        </div>

                        <!-- Primary Email -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏•‡∏±‡∏Å *</label>
                            <input type="email" id="primaryEmail" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="panuwat@kandit.ac.th">
                            <p class="text-xs text-gray-500 mt-1">‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                        </div>

                        <!-- Additional Emails -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
                            <div id="additionalEmailsList" class="space-y-2 mb-3">
                                <!-- Additional emails will be displayed here -->
                            </div>
                            <div class="flex gap-2">
                                <input type="email" id="newEmailInput" class="flex-1 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÉ‡∏´‡∏°‡πà...">
                                <button onclick="addEmail()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition duration-300">
                                    ‡πÄ‡∏û‡∏¥‡πà‡∏°
                                </button>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏î‡πâ‡∏ß‡∏¢</p>
                        </div>

                        <!-- Test Email -->
                        <div class="bg-yellow-50 p-4 rounded-lg">
                            <h4 class="font-medium text-yellow-800 mb-2">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•</h4>
                            <p class="text-sm text-yellow-700 mb-3">‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö</p>
                            <button onclick="sendTestEmail()" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg transition duration-300">
                                ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö
                            </button>
                        </div>

                        <!-- Save Button -->
                        <div class="flex gap-4">
                            <button onclick="saveEmailSettings()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition duration-300">
                                ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏µ‡πÄ‡∏°‡∏•
                            </button>
                        </div>
                        
                        <div id="emailStatus" class="mt-4"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-2xl max-w-md w-full">
                <div class="p-6 text-center">
                    <div class="text-6xl mb-4">‚úÖ</div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h2>
                    <p id="successMessage" class="text-gray-600 mb-6"></p>
                    <button onclick="closeModal('successModal')" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-300">
                        ‡∏ï‡∏Å‡∏•‡∏á
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables - ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏±‡∏ö Google Sheets ‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå
        let currentUser = null;
        let webAppUrl = localStorage.getItem('webAppUrl') || 'https://script.google.com/macros/s/AKfycbxmSKZQcSv0RexptdZ8uS72lJgp2-4xa7g06qGCdRDxANg7ae_mvdMpmPFtaOQ5mgWs/exec';
        let spreadsheetId = localStorage.getItem('spreadsheetId') || '';
        let requestCounter = parseInt(localStorage.getItem('requestCounter')) || 0;
        let requests = JSON.parse(localStorage.getItem('requests')) || [];
        
        // Real-time sync variables
        let syncInterval = null;
        let lastSyncTime = localStorage.getItem('lastSyncTime') || null;
        let isOnline = navigator.onLine;
        let pendingChanges = JSON.parse(localStorage.getItem('pendingChanges')) || [];
        
        // Email notification settings
        let emailSettings = JSON.parse(localStorage.getItem('emailSettings')) || {
            primaryEmail: 'panuwat@kandit.ac.th',
            additionalEmails: [],
            enableNotifications: true
        };

        // User database - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ñ‡∏≤‡∏ß‡∏£
        let userDatabase = JSON.parse(localStorage.getItem('userDatabase')) || {
            'admin': { password: 'admin123', name: '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö', role: 'admin' }
        };

        // Real-time sync functions - ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå
        function saveAllData() {
            try {
                localStorage.setItem('requests', JSON.stringify(requests));
                localStorage.setItem('requestCounter', requestCounter.toString());
                localStorage.setItem('userDatabase', JSON.stringify(userDatabase));
                localStorage.setItem('webAppUrl', webAppUrl);
                localStorage.setItem('spreadsheetId', spreadsheetId);
                localStorage.setItem('emailSettings', JSON.stringify(emailSettings));
                localStorage.setItem('pendingChanges', JSON.stringify(pendingChanges));
                localStorage.setItem('lastSaved', new Date().toISOString());
                
                // Update save status display
                updateSaveStatus('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß');
                console.log('‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥');
                
                // Reset status after 2 seconds
                setTimeout(() => {
                    updateSaveStatus(isOnline ? 'üîÑ ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå' : 'üì± ‡πÇ‡∏´‡∏°‡∏î‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå');
                }, 2000);
                
            } catch (error) {
                console.error('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:', error);
                updateSaveStatus('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
                
                // Reset status after 3 seconds
                setTimeout(() => {
                    updateSaveStatus(isOnline ? 'üîÑ ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå' : 'üì± ‡πÇ‡∏´‡∏°‡∏î‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå');
                }, 3000);
            }
        }

        // Real-time sync with Google Sheets
        async function syncWithGoogleSheets() {
            if (!isOnline || !webAppUrl) {
                return;
            }

            try {
                updateSaveStatus('üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡∏¥‡∏á‡∏Ñ‡πå...');
                
                // Get latest data from Google Sheets
                const response = await fetch(webAppUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'getRequests',
                        lastSyncTime: lastSyncTime
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    // Update local data with server data
                    if (result.data && result.data.length > 0) {
                        const serverRequests = result.data;
                        
                        // Merge server data with local data
                        mergeRequestData(serverRequests);
                        
                        // Update counter based on server data
                        const maxId = Math.max(...serverRequests.map(req => 
                            parseInt(req.requestId.replace('REQ', ''))
                        ), requestCounter);
                        requestCounter = maxId;
                        
                        // Update UI
                        updateStatistics();
                        if (currentUser) {
                            loadRequestsList();
                            loadStats();
                        }
                    }
                    
                    // Send pending changes to server
                    await syncPendingChanges();
                    
                    lastSyncTime = new Date().toISOString();
                    localStorage.setItem('lastSyncTime', lastSyncTime);
                    
                    updateSaveStatus('‚úÖ ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                    console.log('üîÑ ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                    
                } else {
                    console.error('Sync error:', result.error);
                    updateSaveStatus('‚ö†Ô∏è ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß');
                }
                
            } catch (error) {
                console.error('Sync error:', error);
                updateSaveStatus('‚ö†Ô∏è ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß');
            }
            
            // Reset status after 3 seconds
            setTimeout(() => {
                updateSaveStatus('üîÑ ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå');
            }, 3000);
        }

        // Merge server data with local data
        function mergeRequestData(serverRequests) {
            const localRequestIds = new Set(requests.map(req => req.requestId));
            
            // Add new requests from server
            serverRequests.forEach(serverReq => {
                const localIndex = requests.findIndex(req => req.requestId === serverReq.requestId);
                
                if (localIndex === -1) {
                    // New request from server
                    requests.push(serverReq);
                } else {
                    // Update existing request if server version is newer
                    const serverTime = new Date(serverReq.updateTime);
                    const localTime = new Date(requests[localIndex].updateTime);
                    
                    if (serverTime > localTime) {
                        requests[localIndex] = serverReq;
                    }
                }
            });
            
            // Save merged data
            saveAllData();
        }

        // Sync pending changes to server
        async function syncPendingChanges() {
            if (pendingChanges.length === 0) {
                return;
            }

            try {
                for (const change of pendingChanges) {
                    const response = await fetch(webAppUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(change)
                    });

                    const result = await response.json();
                    if (result.success) {
                        // Remove successful change from pending
                        const index = pendingChanges.indexOf(change);
                        if (index > -1) {
                            pendingChanges.splice(index, 1);
                        }
                    }
                }
                
                // Save updated pending changes
                localStorage.setItem('pendingChanges', JSON.stringify(pendingChanges));
                updatePendingCount();
                
            } catch (error) {
                console.error('Error syncing pending changes:', error);
            }
        }

        // Add change to pending queue
        function addPendingChange(changeData) {
            pendingChanges.push({
                ...changeData,
                timestamp: new Date().toISOString()
            });
            localStorage.setItem('pendingChanges', JSON.stringify(pendingChanges));
            updatePendingCount();
        }

        // Start real-time sync
        function startRealTimeSync() {
            // Initial sync
            syncWithGoogleSheets();
            
            // Set up periodic sync every 10 seconds
            if (syncInterval) {
                clearInterval(syncInterval);
            }
            
            syncInterval = setInterval(() => {
                if (isOnline && webAppUrl) {
                    syncWithGoogleSheets();
                }
            }, 10000); // Sync every 10 seconds
            
            console.log('üîÑ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå');
        }

        // Stop real-time sync
        function stopRealTimeSync() {
            if (syncInterval) {
                clearInterval(syncInterval);
                syncInterval = null;
            }
            console.log('‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå');
        }

        // Handle online/offline status
        function handleOnlineStatus() {
            isOnline = navigator.onLine;
            
            if (isOnline) {
                updateSaveStatus('üîÑ ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå - ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡∏¥‡∏á‡∏Ñ‡πå...');
                updateSyncStatus('üîÑ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß');
                startRealTimeSync();
            } else {
                updateSaveStatus('üì± ‡πÇ‡∏´‡∏°‡∏î‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå');
                updateSyncStatus('‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï');
                stopRealTimeSync();
            }
            updatePendingCount();
        }

        // Update save status display
        function updateSaveStatus(message) {
            const saveStatusElement = document.getElementById('saveStatus');
            if (saveStatusElement) {
                saveStatusElement.textContent = message;
            }
        }

        // Update sync status display
        function updateSyncStatus(message) {
            const syncStatusElement = document.getElementById('syncStatus');
            if (syncStatusElement) {
                syncStatusElement.textContent = message;
            }
        }

        // Update pending count display
        function updatePendingCount() {
            const pendingCountElement = document.getElementById('pendingCount');
            if (pendingCountElement) {
                const count = pendingChanges.length;
                if (count > 0) {
                    pendingCountElement.textContent = `‚è≥ ‡∏£‡∏≠‡∏ã‡∏¥‡∏á‡∏Ñ‡πå: ${count}`;
                    pendingCountElement.classList.remove('hidden');
                } else {
                    pendingCountElement.classList.add('hidden');
                }
            }
        }

        // Auto-save every 30 seconds
        setInterval(saveAllData, 30000);

        // Save data when page is about to unload
        window.addEventListener('beforeunload', saveAllData);

        // Save data when visibility changes (tab switching)
        document.addEventListener('visibilitychange', function() {
            if (document.visibilityState === 'hidden') {
                saveAllData();
            }
        });

        // Initialize - ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏∞‡∏ö‡∏ö...');
            
            // Load all saved data
            loadAllSavedData();
            
            // Initialize components
            loadSettings();
            setupEventListeners();
            updateStatistics();
            
            // Set up online/offline event listeners
            window.addEventListener('online', handleOnlineStatus);
            window.addEventListener('offline', handleOnlineStatus);
            
            // Start real-time sync if online
            if (isOnline && webAppUrl) {
                startRealTimeSync();
                updateSyncStatus('üîÑ ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå');
            } else {
                updateSaveStatus(isOnline ? 'üîÑ ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå' : 'üì± ‡πÇ‡∏´‡∏°‡∏î‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå');
                updateSyncStatus(isOnline ? '‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏°‡∏µ URL' : '‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï');
            }
            
            // Show pending count
            updatePendingCount();
            
            // Show last saved time
            showLastSavedTime();
            
            console.log('‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Real-time sync enabled)');
        });

        // Load all saved data from localStorage
        function loadAllSavedData() {
            try {
                // Load requests
                const savedRequests = localStorage.getItem('requests');
                if (savedRequests) {
                    requests = JSON.parse(savedRequests);
                    console.log(`üìã ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏≥‡∏Ç‡∏≠ ${requests.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`);
                }

                // Load request counter
                const savedCounter = localStorage.getItem('requestCounter');
                if (savedCounter) {
                    requestCounter = parseInt(savedCounter);
                    console.log(`üî¢ ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${requestCounter}`);
                }

                // Load user database
                const savedUserDB = localStorage.getItem('userDatabase');
                if (savedUserDB) {
                    userDatabase = JSON.parse(savedUserDB);
                    console.log(`üîê ‡πÇ‡∏´‡∏•‡∏î‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ${Object.keys(userDatabase).length} ‡∏Ñ‡∏ô`);
                }

                // Load settings
                const savedWebAppUrl = localStorage.getItem('webAppUrl');
                if (savedWebAppUrl) {
                    webAppUrl = savedWebAppUrl;
                }

                const savedSpreadsheetId = localStorage.getItem('spreadsheetId');
                if (savedSpreadsheetId) {
                    spreadsheetId = savedSpreadsheetId;
                }

                // Load email settings
                const savedEmailSettings = localStorage.getItem('emailSettings');
                if (savedEmailSettings) {
                    emailSettings = JSON.parse(savedEmailSettings);
                }

            } catch (error) {
                console.error('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:', error);
            }
        }

        // Show last saved time
        function showLastSavedTime() {
            const lastSaved = localStorage.getItem('lastSaved');
            if (lastSaved) {
                const savedDate = new Date(lastSaved);
                console.log(`üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${savedDate.toLocaleString('th-TH')}`);
            }
        }

        // Update statistics on main page
        function updateStatistics() {
            const total = requests.length;
            const completed = requests.filter(req => req.status === '‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£').length;
            const pending = total - completed;
            const today = requests.filter(req => req.submitDate === new Date().toLocaleDateString('th-TH')).length;

            document.getElementById('totalRequestsCount').textContent = total;
            document.getElementById('pendingRequestsCount').textContent = pending;
            document.getElementById('completedRequestsCount').textContent = completed;
            document.getElementById('todayRequestsCount').textContent = today;
        }

        // Load requests from Google Sheets
        async function loadRequestsFromServer() {
            try {
                const response = await fetch(webAppUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'getRequests'
                    })
                });
                
                const result = await response.json();
                if (result.success && result.data) {
                    requests = result.data;
                    requestCounter = requests.length;
                    // Update local storage
                    localStorage.setItem('requests', JSON.stringify(requests));
                    localStorage.setItem('requestCounter', requestCounter.toString());
                    updateStatistics();
                }
            } catch (error) {
                console.error('Error loading requests from server:', error);
                // Fallback to local storage if server fails
                console.log('Using local storage as fallback');
                updateStatistics();
            }
        }

        function setupEventListeners() {
            // Name change checkbox
            document.getElementById('nameChangeCheck').addEventListener('change', function() {
                const oldNameSection = document.getElementById('oldNameSection');
                if (this.checked) {
                    oldNameSection.classList.remove('hidden');
                } else {
                    oldNameSection.classList.add('hidden');
                }
            });

            // Student status change
            document.querySelector('select[name="studentStatus"]').addEventListener('change', function() {
                const currentStudentFields = document.getElementById('currentStudentFields');
                const formerStudentFields = document.getElementById('formerStudentFields');
                
                // Reset all fields
                currentStudentFields.classList.add('hidden');
                formerStudentFields.classList.add('hidden');
                
                // Clear required attributes
                document.querySelector('select[name="faculty"]').required = false;
                document.querySelector('input[name="room"]').required = false;
                document.querySelector('select[name="graduatedLevel"]').required = false;
                document.querySelector('input[name="graduationYear"]').required = false;
                
                if (this.value === '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô') {
                    currentStudentFields.classList.remove('hidden');
                    document.querySelector('select[name="faculty"]').required = true;
                    document.querySelector('input[name="room"]').required = true;
                } else if (this.value === '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏Å‡πà‡∏≤') {
                    formerStudentFields.classList.remove('hidden');
                    document.querySelector('select[name="graduatedLevel"]').required = true;
                    document.querySelector('input[name="graduationYear"]').required = true;
                }
            });

            // Other document checkbox
            document.getElementById('otherDocumentCheck').addEventListener('change', function() {
                const otherDocumentInput = document.getElementById('otherDocumentInput');
                const otherDocumentDetail = document.querySelector('input[name="otherDocumentDetail"]');
                
                if (this.checked) {
                    otherDocumentInput.classList.remove('hidden');
                    otherDocumentDetail.required = true;
                } else {
                    otherDocumentInput.classList.add('hidden');
                    otherDocumentDetail.required = false;
                    otherDocumentDetail.value = '';
                }
            });

            // Purpose selection change
            document.querySelector('select[name="purpose"]').addEventListener('change', function() {
                const otherPurposeInput = document.getElementById('otherPurposeInput');
                const otherPurposeDetail = document.querySelector('input[name="otherPurposeDetail"]');
                
                if (this.value === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ') {
                    otherPurposeInput.classList.remove('hidden');
                    otherPurposeDetail.required = true;
                } else {
                    otherPurposeInput.classList.add('hidden');
                    otherPurposeDetail.required = false;
                    otherPurposeDetail.value = '';
                }
            });

            // Form submissions
            document.getElementById('documentForm').addEventListener('submit', handleDocumentSubmit);
            document.getElementById('trackForm').addEventListener('submit', handleTrackSubmit);
            document.getElementById('adminForm').addEventListener('submit', handleAdminLogin);
        }

        // Modal functions
        function showSubmitForm() {
            document.getElementById('submitModal').classList.remove('hidden');
        }

        function showTrackForm() {
            document.getElementById('trackModal').classList.remove('hidden');
        }

        function showAdminLogin() {
            document.getElementById('adminModal').classList.remove('hidden');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
            if (modalId === 'submitModal') {
                document.getElementById('documentForm').reset();
                document.getElementById('oldNameSection').classList.add('hidden');
                document.getElementById('nameChangeCheck').checked = false;
                document.getElementById('otherDocumentInput').classList.add('hidden');
                document.getElementById('otherDocumentCheck').checked = false;
                document.querySelector('input[name="otherDocumentDetail"]').required = false;
                
                // Hide purpose input
                document.getElementById('otherPurposeInput').classList.add('hidden');
                document.querySelector('input[name="otherPurposeDetail"]').required = false;
                
                // Hide student status fields
                document.getElementById('currentStudentFields').classList.add('hidden');
                document.getElementById('formerStudentFields').classList.add('hidden');
                
                // Reset required attributes
                document.querySelector('select[name="faculty"]').required = false;
                document.querySelector('input[name="room"]').required = false;
                document.querySelector('select[name="graduatedLevel"]').required = false;
                document.querySelector('input[name="graduationYear"]').required = false;
            }
        }

        function showSuccess(message) {
            document.getElementById('successMessage').textContent = message;
            document.getElementById('successModal').classList.remove('hidden');
        }

        // Document submission - ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏±‡∏ö Google Sheets
        async function handleDocumentSubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = {};
            
            // Get form data
            for (let [key, value] of formData.entries()) {
                if (key === 'documents') {
                    if (!data[key]) data[key] = [];
                    data[key].push(value);
                } else {
                    data[key] = value;
                }
            }

            // Validate required fields
            if (!data.documents || data.documents.length === 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
                return;
            }

            // Handle "‡∏≠‡∏∑‡πà‡∏ô‡πÜ" document type
            if (data.documents.includes('‡∏≠‡∏∑‡πà‡∏ô‡πÜ')) {
                if (!data.otherDocumentDetail || data.otherDocumentDetail.trim() === '') {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡∏∑‡πà‡∏ô‡πÜ');
                    return;
                }
                // Replace "‡∏≠‡∏∑‡πà‡∏ô‡πÜ" with the detailed description
                const index = data.documents.indexOf('‡∏≠‡∏∑‡πà‡∏ô‡πÜ');
                data.documents[index] = `‡∏≠‡∏∑‡πà‡∏ô‡πÜ: ${data.otherDocumentDetail.trim()}`;
            }

            // Handle "‡∏≠‡∏∑‡πà‡∏ô‡πÜ" purpose type
            if (data.purpose === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ') {
                if (!data.otherPurposeDetail || data.otherPurposeDetail.trim() === '') {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÜ');
                    return;
                }
                data.purpose = `‡∏≠‡∏∑‡πà‡∏ô‡πÜ: ${data.otherPurposeDetail.trim()}`;
            }

            // Generate request ID
            requestCounter++;
            const requestId = 'REQ' + String(requestCounter).padStart(4, '0');
            
            // Prepare request data based on student status
            const requestData = {
                requestId: requestId,
                titlePrefix: data.titlePrefix,
                fullName: data.fullName,
                oldTitlePrefix: data.oldTitlePrefix || '',
                oldName: data.oldName || '',
                hasNameChange: document.getElementById('nameChangeCheck').checked ? '‡πÉ‡∏ä‡πà' : '‡πÑ‡∏°‡πà',
                studentId: data.studentId,
                studentStatus: data.studentStatus,
                documents: data.documents.join(', '),
                quantity: data.quantity,
                purpose: data.purpose,
                phone: data.phone,
                submitDate: new Date().toLocaleDateString('th-TH'),
                submitTime: new Date().toLocaleTimeString('th-TH'),
                status: '‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏Ç‡∏≠',
                updateTime: new Date().toLocaleString('th-TH')
            };

            // Add fields based on student status
            if (data.studentStatus === '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô') {
                requestData.faculty = data.faculty;
                requestData.room = data.room;
                requestData.graduationYear = '';
            } else if (data.studentStatus === '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏Å‡πà‡∏≤') {
                requestData.faculty = data.graduatedLevel;
                requestData.room = '';
                requestData.graduationYear = data.graduationYear;
            }

            // Save locally first
            requests.push(requestData);
            
            // Update statistics
            updateStatistics();
            
            // Save all data immediately
            saveAllData();

            // Send to Google Sheets and Email Notification (Real-time)
            if (isOnline && webAppUrl) {
                try {
                    updateSaveStatus('üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...');
                    
                    const response = await fetch(webAppUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: 'addRow',
                            data: requestData,
                            emailSettings: emailSettings.enableNotifications ? emailSettings : null
                        })
                    });

                    const result = await response.json();
                    if (result.success) {
                        updateSaveStatus('‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                        closeModal('submitModal');
                        showSuccess(`‡∏¢‡∏∑‡πà‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠: ${requestId}\n‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô Google Sheets ‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå‡πÅ‡∏•‡πâ‡∏ß${emailSettings.enableNotifications ? '\n‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß' : ''}\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏à‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞`);
                    } else {
                        console.error('Google Sheets error:', result.error);
                        // Add to pending changes for later sync
                        addPendingChange({
                            action: 'addRow',
                            data: requestData,
                            emailSettings: emailSettings.enableNotifications ? emailSettings : null
                        });
                        updateSaveStatus('‚ö†Ô∏è ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á');
                        closeModal('submitModal');
                        showSuccess(`‡∏¢‡∏∑‡πà‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠: ${requestId}\n(‡∏à‡∏∞‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÑ‡∏õ Google Sheets ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ)\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏à‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞`);
                    }
                } catch (error) {
                    console.error('Error sending to Google Sheets:', error);
                    // Add to pending changes for later sync
                    addPendingChange({
                        action: 'addRow',
                        data: requestData,
                        emailSettings: emailSettings.enableNotifications ? emailSettings : null
                    });
                    updateSaveStatus('‚ö†Ô∏è ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á');
                    closeModal('submitModal');
                    showSuccess(`‡∏¢‡∏∑‡πà‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠: ${requestId}\n(‡∏à‡∏∞‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÑ‡∏õ Google Sheets ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ)\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏à‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞`);
                }
            } else {
                // Offline mode - add to pending changes
                addPendingChange({
                    action: 'addRow',
                    data: requestData,
                    emailSettings: emailSettings.enableNotifications ? emailSettings : null
                });
                closeModal('submitModal');
                showSuccess(`‡∏¢‡∏∑‡πà‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠: ${requestId}\n(‡πÇ‡∏´‡∏°‡∏î‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå - ‡∏à‡∏∞‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå)\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏à‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞`);
            }
        }

        // Track status
        function handleTrackSubmit(e) {
            e.preventDefault();
            
            const query = document.getElementById('searchQuery').value.trim();
            const results = requests.filter(req => 
                req.requestId.toLowerCase().includes(query.toLowerCase()) ||
                req.fullName.toLowerCase().includes(query.toLowerCase())
            );

            displayTrackResults(results);
        }

        function displayTrackResults(results) {
            const resultDiv = document.getElementById('trackResult');
            
            if (results.length === 0) {
                resultDiv.innerHTML = `
                    <div class="text-center py-8">
                        <div class="text-4xl mb-4">üòî</div>
                        <p class="text-gray-600">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p>
                        <p class="text-sm text-gray-500 mt-2">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                    </div>
                `;
            } else {
                resultDiv.innerHTML = results.map(req => `
                    <div class="border border-gray-200 rounded-lg p-4 mb-4">
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <h4 class="font-bold text-lg">${req.requestId}</h4>
                                <p class="text-gray-600">${req.fullName}</p>
                            </div>
                            <span class="px-3 py-1 rounded-full text-sm ${getStatusColor(req.status)}">${req.status}</span>
                        </div>
                        
                        <div class="mb-4">
                            <p class="text-sm text-gray-600 mb-2">‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏Ç‡∏≠: ${req.documents}</p>
                            <p class="text-sm text-gray-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${req.quantity} ‡∏â‡∏ö‡∏±‡∏ö</p>
                        </div>

                        <div class="space-y-2">
                            ${generateStatusSteps(req.status)}
                        </div>
                        
                        <div class="mt-3 text-xs text-gray-500">
                            ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ó‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${req.updateTime}
                        </div>
                    </div>
                `).join('');
            }
            
            resultDiv.classList.remove('hidden');
        }

        function getStatusColor(status) {
            const colors = {
                '‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏Ç‡∏≠': 'bg-yellow-100 text-yellow-800',
                '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•': 'bg-orange-100 text-orange-800',
                '‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£': 'bg-purple-100 text-purple-800',
                '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£': 'bg-indigo-100 text-indigo-800',
                '‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£': 'bg-green-100 text-green-800'
            };
            return colors[status] || 'bg-gray-100 text-gray-800';
        }

        function generateStatusSteps(currentStatus) {
            const steps = [
                '‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏Ç‡∏≠',
                '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                '‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£',
                '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£',
                '‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£'
            ];
            
            const currentIndex = steps.indexOf(currentStatus);
            
            return steps.map((step, index) => {
                const isCompleted = index <= currentIndex;
                const isCurrent = index === currentIndex;
                
                return `
                    <div class="flex items-center">
                        <div class="w-4 h-4 rounded-full mr-3 ${isCompleted ? 'bg-green-500' : 'bg-gray-300'}"></div>
                        <span class="text-sm ${isCurrent ? 'font-bold text-green-600' : isCompleted ? 'text-green-600' : 'text-gray-500'}">${step}</span>
                        ${isCompleted ? '<span class="ml-2 text-green-500">‚úì</span>' : ''}
                    </div>
                `;
            }).join('');
        }

        // Admin functions
        function handleAdminLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('adminUsername').value;
            const password = document.getElementById('adminPassword').value;
            
            if (userDatabase[username] && userDatabase[username].password === password) {
                currentUser = { username, ...userDatabase[username] };
                closeModal('adminModal');
                showAdminDashboard();
            } else {
                alert('‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
            }
        }

        function showAdminDashboard() {
            document.querySelector('header').style.display = 'none';
            document.querySelector('main').style.display = 'none';
            document.getElementById('adminDashboard').classList.remove('hidden');
            document.getElementById('adminWelcome').textContent = `‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö, ${currentUser.name}`;
            
            loadAdminData();
        }

        function logout() {
            currentUser = null;
            document.querySelector('header').style.display = 'block';
            document.querySelector('main').style.display = 'block';
            document.getElementById('adminDashboard').classList.add('hidden');
            
            // Reset admin form
            document.getElementById('adminForm').reset();
        }

        function showAdminTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.admin-tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.admin-tab-btn').forEach(btn => {
                btn.classList.remove('active', 'border-purple-500', 'text-purple-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });
            
            // Show selected tab
            document.getElementById(tabName + 'Tab').classList.remove('hidden');
            
            // Add active class to selected button
            event.target.classList.add('active', 'border-purple-500', 'text-purple-600');
            event.target.classList.remove('border-transparent', 'text-gray-500');
            
            // Load tab-specific data
            if (tabName === 'documents') {
                loadRequestsList();
            } else if (tabName === 'users') {
                loadUsersList();
            } else if (tabName === 'stats') {
                loadStats();
            } else if (tabName === 'settings') {
                loadSettings();
            } else if (tabName === 'email') {
                loadEmailSettings();
            }
        }

        function loadAdminData() {
            loadRequestsList();
            loadStats();
        }

        function loadRequestsList() {
            const requestsList = document.getElementById('requestsList');
            
            if (requests.length === 0) {
                requestsList.innerHTML = `
                    <div class="text-center py-8">
                        <div class="text-4xl mb-4">üìã</div>
                        <p class="text-gray-600">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</p>
                    </div>
                `;
                return;
            }

            requestsList.innerHTML = requests.map(req => `
                <div class="border border-gray-200 rounded-lg p-4 request-item" data-status="${req.status}">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h4 class="font-bold text-lg">${req.requestId}</h4>
                            <p class="text-gray-600">${req.fullName} (${req.studentId})</p>
                            <p class="text-sm text-gray-500">${req.faculty}${req.room ? '/' + req.room : ''}</p>
                        </div>
                        <span class="px-3 py-1 rounded-full text-sm ${getStatusColor(req.status)}">${req.status}</span>
                    </div>
                    
                    <div class="mb-4">
                        <p class="text-sm text-gray-600 mb-1">‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏Ç‡∏≠: ${req.documents}</p>
                        <p class="text-sm text-gray-600 mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${req.quantity} ‡∏â‡∏ö‡∏±‡∏ö</p>
                        <p class="text-sm text-gray-600 mb-1">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå: ${req.purpose}</p>
                        <p class="text-sm text-gray-600">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£: ${req.phone}</p>
                    </div>

                    <div class="flex gap-2 flex-wrap">
                        ${generateActionButtons(req)}
                    </div>
                    
                    <div class="mt-3 text-xs text-gray-500">
                        ‡∏¢‡∏∑‡πà‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠: ${req.submitDate} ${req.submitTime} | ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ó‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${req.updateTime}
                    </div>
                </div>
            `).join('');
        }

        function generateActionButtons(req) {
            const steps = [
                '‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏Ç‡∏≠',
                '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                '‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£',
                '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£',
                '‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£'
            ];
            
            const currentIndex = steps.indexOf(req.status);
            const nextStep = steps[currentIndex + 1];
            
            let buttons = '';
            
            if (nextStep) {
                buttons += `
                    <button onclick="updateRequestStatus('${req.requestId}', '${nextStep}')" 
                            class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition duration-300">
                        ‡∏ó‡∏≥${nextStep}‡πÄ‡∏™‡∏£‡πá‡∏à
                    </button>
                `;
            }
            
            if (req.status !== '‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏Ç‡∏≠') {
                const prevStep = steps[currentIndex - 1];
                buttons += `
                    <button onclick="updateRequestStatus('${req.requestId}', '${prevStep}')" 
                            class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm transition duration-300">
                        ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
                    </button>
                `;
            }
            
            return buttons;
        }

        // Update request status - ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏±‡∏ö Google Sheets ‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå
        async function updateRequestStatus(requestId, newStatus) {
            const requestIndex = requests.findIndex(req => req.requestId === requestId);
            if (requestIndex === -1) return;

            const updateTime = new Date().toLocaleString('th-TH');
            
            // Update local data first
            requests[requestIndex].status = newStatus;
            requests[requestIndex].updateTime = updateTime;
            
            // Save all data immediately
            saveAllData();

            // Update Google Sheets (Real-time)
            if (isOnline && webAppUrl) {
                try {
                    updateSaveStatus('üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞...');
                    
                    const response = await fetch(webAppUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: 'updateStatus',
                            requestId: requestId,
                            status: newStatus,
                            updateTime: updateTime
                        })
                    });

                    const result = await response.json();
                    if (result.success) {
                        updateSaveStatus('‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ó‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                    } else {
                        console.error('Google Sheets update error:', result.error);
                        // Add to pending changes for later sync
                        addPendingChange({
                            action: 'updateStatus',
                            requestId: requestId,
                            status: newStatus,
                            updateTime: updateTime
                        });
                        updateSaveStatus('‚ö†Ô∏è ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á');
                    }
                } catch (error) {
                    console.error('Error updating Google Sheets:', error);
                    // Add to pending changes for later sync
                    addPendingChange({
                        action: 'updateStatus',
                        requestId: requestId,
                        status: newStatus,
                        updateTime: updateTime
                    });
                    updateSaveStatus('‚ö†Ô∏è ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á');
                }
            } else {
                // Offline mode - add to pending changes
                addPendingChange({
                    action: 'updateStatus',
                    requestId: requestId,
                    status: newStatus,
                    updateTime: updateTime
                });
                updateSaveStatus('üì± ‡πÇ‡∏´‡∏°‡∏î‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå');
            }

            // Reload the list and update statistics
            loadRequestsList();
            loadStats();
            updateStatistics();
        }

        function filterRequests(status) {
            // Remove active class from all filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.add('bg-gray-100', 'text-gray-800');
                btn.classList.remove('bg-blue-100', 'text-blue-800');
            });
            
            // Add active class to clicked button
            event.target.classList.add('active', 'bg-blue-100', 'text-blue-800');
            event.target.classList.remove('bg-gray-100', 'text-gray-800');
            
            // Filter requests
            const requestItems = document.querySelectorAll('.request-item');
            requestItems.forEach(item => {
                if (status === 'all' || item.dataset.status === status) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function loadUsersList() {
            const usersList = document.getElementById('usersList');
            const users = Object.entries(userDatabase);
            
            usersList.innerHTML = users.map(([username, user]) => `
                <div class="border border-gray-200 rounded-lg p-4">
                    <div class="flex justify-between items-center">
                        <div>
                            <h4 class="font-bold">${user.name}</h4>
                            <p class="text-gray-600">@${username}</p>
                            <span class="px-2 py-1 rounded-full text-xs ${user.role === 'admin' ? 'bg-red-100 text-red-800' : 'bg-blue-100 text-blue-800'}">${user.role}</span>
                        </div>
                        <div class="space-x-2">
                            <button onclick="resetUserPassword('${username}')" class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded text-sm transition duration-300">
                                ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
                            </button>
                            ${username !== 'admin' ? `
                                <button onclick="deleteUser('${username}')" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition duration-300">
                                    ‡∏•‡∏ö
                                </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function showAddUserForm() {
            const name = prompt('‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•:');
            if (!name) return;
            
            const username = prompt('Username:');
            if (!username || userDatabase[username]) {
                alert('Username ‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß');
                return;
            }
            
            const password = prompt('Password:');
            if (!password) return;
            
            const role = confirm('‡πÄ‡∏õ‡πá‡∏ô Admin ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? (‡∏ï‡∏Å‡∏•‡∏á = Admin, ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å = Staff)') ? 'admin' : 'staff';
            
            userDatabase[username] = { password, name, role };
            
            // Save all data immediately
            saveAllData();
            loadUsersList();
        }

        function resetUserPassword(username) {
            const newPassword = prompt(`‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${username}:`);
            if (newPassword) {
                userDatabase[username].password = newPassword;
                
                // Save all data immediately
                saveAllData();
                alert('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
            }
        }

        function deleteUser(username) {
            if (confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ${username} ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
                delete userDatabase[username];
                
                // Save all data immediately
                saveAllData();
                loadUsersList();
            }
        }

        function loadStats() {
            const total = requests.length;
            const completed = requests.filter(req => req.status === '‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£').length;
            const pending = total - completed;
            const today = requests.filter(req => req.submitDate === new Date().toLocaleDateString('th-TH')).length;

            document.getElementById('totalRequests').textContent = total;
            document.getElementById('pendingRequests').textContent = pending;
            document.getElementById('completedRequests').textContent = completed;
            document.getElementById('todayRequests').textContent = today;
        }

        function loadSettings() {
            document.getElementById('webAppUrl').value = webAppUrl;
            document.getElementById('spreadsheetId').value = spreadsheetId;
        }

        async function testConnection() {
            const url = document.getElementById('webAppUrl').value;
            if (!url) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Web App URL');
                return;
            }

            const statusDiv = document.getElementById('connectionStatus');
            statusDiv.innerHTML = '<div class="text-blue-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</div>';

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'test'
                    })
                });
                
                const result = await response.json();
                
                if (result.success !== false) {
                    statusDiv.innerHTML = '<div class="text-green-600">‚úÖ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>';
                } else {
                    statusDiv.innerHTML = '<div class="text-red-600">‚ùå ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß</div>';
                }
            } catch (error) {
                statusDiv.innerHTML = '<div class="text-red-600">‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ</div>';
            }
        }

        function saveSettings() {
            webAppUrl = document.getElementById('webAppUrl').value;
            spreadsheetId = document.getElementById('spreadsheetId').value;
            
            // Save all data immediately
            saveAllData();
            
            alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        }

        // Email Settings Functions
        function loadEmailSettings() {
            document.getElementById('enableNotifications').checked = emailSettings.enableNotifications;
            document.getElementById('primaryEmail').value = emailSettings.primaryEmail;
            
            // Load additional emails
            displayAdditionalEmails();
        }

        function displayAdditionalEmails() {
            const container = document.getElementById('additionalEmailsList');
            container.innerHTML = emailSettings.additionalEmails.map((email, index) => `
                <div class="flex items-center justify-between p-2 bg-gray-50 rounded-lg">
                    <span class="text-sm">${email}</span>
                    <button onclick="removeEmail(${index})" class="text-red-500 hover:text-red-700 text-sm">
                        ‡∏•‡∏ö
                    </button>
                </div>
            `).join('');
        }

        function addEmail() {
            const newEmailInput = document.getElementById('newEmailInput');
            const email = newEmailInput.value.trim();
            
            if (!email) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏≠‡∏µ‡πÄ‡∏°‡∏•');
                return;
            }
            
            if (!isValidEmail(email)) {
                alert('‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                return;
            }
            
            if (emailSettings.additionalEmails.includes(email)) {
                alert('‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß');
                return;
            }
            
            emailSettings.additionalEmails.push(email);
            newEmailInput.value = '';
            displayAdditionalEmails();
            
            // Save immediately
            saveAllData();
        }

        function removeEmail(index) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                emailSettings.additionalEmails.splice(index, 1);
                displayAdditionalEmails();
                
                // Save immediately
                saveAllData();
            }
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function saveEmailSettings() {
            const enableNotifications = document.getElementById('enableNotifications').checked;
            const primaryEmail = document.getElementById('primaryEmail').value.trim();
            
            if (!primaryEmail) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏•‡∏±‡∏Å');
                return;
            }
            
            if (!isValidEmail(primaryEmail)) {
                alert('‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏•‡∏±‡∏Å‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                return;
            }
            
            emailSettings.enableNotifications = enableNotifications;
            emailSettings.primaryEmail = primaryEmail;
            
            // Save all data immediately
            saveAllData();
            
            const statusDiv = document.getElementById('emailStatus');
            statusDiv.innerHTML = '<div class="text-green-600">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>';
            
            setTimeout(() => {
                statusDiv.innerHTML = '';
            }, 3000);
        }

        async function sendTestEmail() {
            if (!emailSettings.primaryEmail) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏•‡∏±‡∏Å‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }
            
            const statusDiv = document.getElementById('emailStatus');
            statusDiv.innerHTML = '<div class="text-blue-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö...</div>';
            
            try {
                const response = await fetch(webAppUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'sendTestEmail',
                        emailSettings: emailSettings
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    statusDiv.innerHTML = '<div class="text-green-600">‚úÖ ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>';
                } else {
                    statusDiv.innerHTML = '<div class="text-red-600">‚ùå ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß</div>';
                }
            } catch (error) {
                statusDiv.innerHTML = '<div class="text-red-600">‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•</div>';
            }
            
            setTimeout(() => {
                statusDiv.innerHTML = '';
            }, 5000);
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'975b0ae470954f5d',t:'MTc1NjI5MjE4OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
